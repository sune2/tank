# 戦車ゲーム #

Node.jsの研修で作成(2015/07/01 - 2015/07/10)

[heroku](https://mytank.herokuapp.com)

## 概要 ##
戦車を操作して戦うリアルタイム通信ブラウザ対戦ゲーム

## 実行方法 ##

```sh
$ npm install # ライブラリをインストール
$ node app.js & # サーバ起動
$ open http://localhost:3000 # URLアクセス
```

## ゲームの操作方法 ##
- 左右キー : 戦車の回転
- 上キー : 戦車を前進
- スペースキー : 砲弾を発射
- qキー : タイトルに戻る

## 利用したライブラリ ##


### サーバ ###

* express
* socket.io

### クライアント ###

* enchant.js
* jquery

jqueryはほとんど使っていない

### テスト（サーバの一部のみ） ###

* mocha
* expect.js
* socket.io-client

## サーバとクライアント各々の処理について ##

### サーバ ###

* 現在のゲームの状況（タイトルかゲーム中か）を管理
* 現在の参加者（戦車）を管理
* 現在フィールドにある砲弾を管理
* 戦車と砲弾の当たり判定を行う

### クライアント ###

* キー入力を受け付けて、サーバにその情報を送る
* サーバから受け取った情報を基に、戦車や砲弾を描画

## ゲーム開始までの流れ ##

1. URLにアクセスすると現在のゲームの状況が送られる
2. ゲームの状況に応じてシーンを作成する（以下タイトルシーンの場合）
3. シーンの作成が終わったら、現在の戦車（敵）の情報を受け取って描画
5. ゲームに参加可能な状態ならば、"join"メッセージにより参加可能
6. あるクライアントが"startGame"を送るとサーバが全クライアントに"startGame"を送る
7. "startGame"を受け取った各クライアントは、ゲームシーンに遷移して"startGameReady"をサーバに送る
8. "startGameReady"が全クライアントから送られたとき、タンク情報をクライアントに送ってゲームが開始する

## 通信遅延への対策 ##

* キー入力された瞬間に自機の移動や砲弾の発射を描画するのではなく、サーバに情報を送ってそれがまた返ってきたときに描画する
* 当たり判定をサーバで行い、ヒットしたときクライアントに知らせる

これらの対策により、戦車と砲弾の位置が全クライアントで一致し、砲弾のヒットの結果も一致する。
